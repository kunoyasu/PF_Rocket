<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <title>アポロ18Go!</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <!-- ボタン -->
    <div class="container">
      <div class="col-md-6">
        <p class="text-center">中央</p>
      </div>
      <div id="result" class="standby"></div>
      <div id="buttons">
        <div id="stop">Stop</div>
      </div>
    </div>
    <div class="content">
      <figure><img class="img-fluid" src="./images/rocket.png" alt="ロケット" width="200" height="200" /></figure>
    </div>
    <div class="text-center">
      <img class="img-fluid-fire" src="./images/fire1.png" alt="ロケット" width="100" height="100" />
      <img class="img-fluid-fire" src="./images/fire2.png" alt="ロケット" width="100" height="100" />
      <img class="img-fluid-fire" src="./images/fire3.png" alt="ロケット" width="100" height="120" />
    </div>

    <!-- Start用Modalはじまり -->
    <div class="modal fade modal-dialog modal-fullscreen-sm-down" id="startModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="startModalLabel">はじめますか？</h5>
          </div>
          <div class="modal-body" id="startmodalBody">
            <p></p>
            <a href="" target="_blank" rel="noopener noreferrer">ツイートする</a>
          </div>
          <div class="modal-footer">
            <button id="start" type="button" class="btn btn-secondary">はじめる</button>
          </div>
        </div>
      </div>
    </div>
    <!-- ReStart用Modalはじまり -->
    <div class="modal fade modal-dialog modal-fullscreen-sm-down" id="resultModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="resultModalLabel"></h5>
          </div>
          <div class="modal-body" id="resultBody"></div>
          <div class="modal-footer">
            <button id="reload" type="button" class="btn btn-secondary" onclick="location.reload()">
              もう一度挑戦する
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- ReStart用Modal終わり -->
  </body>
  <script>
    // 開始時のモーダル
    const startDialog = document.getElementById('startModal')
    const startButton = document.getElementById('start')
    // ストップボタン
    const stopButton = document.querySelector('#stop')

    // 結果時のモーダル
    const resultDialog = document.getElementById('resultModal')
    const resultTitle = document.getElementById('resultModalLabel')
    const resultBody = document.getElementById('resultBody')

    var diff = 0

    console.log(stopButton)
    window.onload = () => {
      startDialog.tabIndex = '-1'
      startDialog.ariaModal = 'true'
      startDialog.role = 'dialog'
      startDialog.style = 'display: block;'
      startDialog.classList.add('show')
    }

    // 結果のテキスト
    const resultText = document.getElementById('text')

    // モーダルの表示に関する関数
    const modal = function () {
      resultDialog.tabIndex = '-1'
      resultDialog.ariaModal = 'true'
      resultDialog.role = 'dialog'
      resultDialog.style = 'display: block;'
      resultDialog.classList.add('show')
      resultDialog.setAttribute('aria-hidden', 'true')
    }

    // スタートボタン
    startButton.addEventListener('click', function () {
      startDialog.remove()
      progress = 0
    })

    stopButton.addEventListener('click', function () {
      clearInterval(stop)
      // 結果モーダル出力
      setTimeout(function () {
        modal()
      })
    })

    // 結果モーダル出力
    setTimeout(function () {
      modal()
      if (diff > -0.5 && diff < 0.5) {
        resultTitle.innerText = '完璧'
        resultBody.innerHTML = '完璧なできです。'
        document.body.style.backgroundColor = '#ccffcc'
      } else if (diff > -1.0 && diff < 1.0) {
        resultTitle.innerText = '惜しい！！'
        resultBody.innerHTML = 'もう少しです'
        document.body.style.backgroundColor = '#ccffcc'
      } else {
        resultTitle.innerText = '全然です！'
        resultBody.innerHTML = 'もう一回チャレンジしてみよー'
        document.body.style.backgroundColor = '#ccffcc'
      }
    }, 8000)

    // タイマー
    ;(function () {
      'use strict'

      var start = document.getElementById('start')
      var stop = document.getElementById('stop')
      var result = document.getElementById('result')
      var startTime
      var isStarted = false

      start.addEventListener('click', function () {
        if (isStarted === true) {
          return
        }
        isStarted = true
        startTime = Date.now()
        this.className = 'pushed'
        stop.className = ''
        result.textContent = '0.000'
        result.className = 'stanby'
      })

      stop.addEventListener('click', function () {
        var elapsedTime

        if (isStarted === false) {
          return
        }
        isStarted = false
        elapsedTime = (Date.now() - startTime) / 1000
        result.textContent = elapsedTime.toFixed(3)
        this.className = 'pushed'
        start.className = ''
        result.className = ''
        diff = elapsedTime - 5.0
        if (diff > -1.0 && diff < 1.0) {
          result.className = 'perfect'
        }
      })
    })()
  </script>
</html>
