<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>アポロ18Go!</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- ボタン -->
    <div class="container">
      <div id="result" class="standby"></div>
      <div id="buttons">
        <div id="stop">Stop</div>
      </div>
    </div>
    <div class="content">
      <div class="rocket">
        <img class="img-fluid" src="./images/rocket.png" alt="ロケット" />
      </div>
      <div class="text-center astronaut-container">
        <img
          id="astronaut"
          src="./images/astronaut.png"
          class="img-fluid-astronaut"
          alt="宇宙飛行士"
          width="100"
          height="100"
        />
      </div>
    </div>
    <div class="text-center">
      <img id="fire" class="img-fluid fire" alt="fire" />
    </div>
    <div class="text-center">
      <img id="people" class="img-fluid-people" alt="people" />
    </div>

    <!-- Start用Modalはじまり -->
    <div class="modal fade modal-dialog modal-fullscreen-sm-down" id="startModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="startModalLabel">はじめますか？</h5>
          </div>
          <div class="modal-body" id="startmodalBody">
            <p></p>
            <a href="" target="_blank" rel="noopener noreferrer">ツイートする</a>
          </div>
          <div class="modal-footer">
            <button id="start" type="button" class="btn btn-secondary">はじめる</button>
          </div>
        </div>
      </div>
    </div>
    <!-- ReStart用Modalはじまり -->
    <div class="modal fade modal-dialog modal-fullscreen-sm-down" id="resultModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="resultModalLabel"></h5>
          </div>
          <div class="modal-body" id="resultBody"></div>
          <div class="modal-footer">
            <button id="reload" type="button" class="btn btn-secondary" onclick="location.reload()">
              もう一度挑戦する
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    // ストップボタン
    const stopButton = document.querySelector('#stop')
    // 開始時のモーダル
    const startDialog = document.getElementById('startModal')
    const startButton = document.getElementById('start')
    // 結果時のモーダル
    const resultDialog = document.getElementById('resultModal')
    const resultTitle = document.getElementById('resultModalLabel')
    const resultBody = document.getElementById('resultBody')

    var result = document.getElementById('result')
    var startTime
    var intervalId

    // ロード時にモーダル表示
    window.onload = () => {
      document.getElementById('astronaut').style.visibility = 'hidden'
      startDialog.ariaModal = 'true'
      startDialog.role = 'dialog'
      startDialog.style = 'display: block;'
      startDialog.classList.add('show')
    }

    // モーダルの表示の設定
    const modal = function () {
      resultDialog.ariaModal = 'true'
      resultDialog.role = 'dialog'
      resultDialog.style = 'display: block;'
      resultDialog.classList.add('show')
      resultDialog.setAttribute('aria-hidden', 'true')
    }

    // スタート押下時
    startButton.addEventListener('click', function () {
      startTime = Date.now()
      startDialog.remove()
      picChange()
    })

    // STOP押下時
    stopButton.addEventListener('click', function () {
      clearInterval(intervalId)

      var elapsedTime
      var diff

      elapsedTime = (Date.now() - startTime) / 1000
      result.textContent = elapsedTime.toFixed(3)
      diff = elapsedTime - 5.0

      if (diff > -0.5 && diff < 0.5) {
        resultTitle.innerText = 'ロケット発射成功！！！'
        resultBody.innerHTML = 'アポロ18号は無事発射成功しました！'
      } else if (diff > -1.0 && diff < 1.0) {
        resultTitle.innerText = '打ち上げ失敗！！'
        resultBody.innerHTML = '残念。ロケットは打ち上げに失敗してしまいました。'
      } else {
        resultTitle.innerText = '大爆発！！'
        resultBody.innerHTML = 'ロケットは爆発シてしまいました。もう一回チャレンジしてみてね'
      }
      // 結果モーダル出力
      modal()
    })

    function picChange() {
      var elapsedTime

      stop = elapsedTime = Math.floor((Date.now() - startTime) / 1000)
      const fireImg = ['./images/fire1.png', './images/fire2.png', './images/fire3.png']
      const peopleImg = ['./images/people1.png', './images/people2.png', './images/people3.png']

      if (elapsedTime < 1) {
        //画像選択
        fire.src = fireImg[0]
        people.src = peopleImg[0]
      } else if (2 <= elapsedTime < 3) {
        fire.src = fireImg[1]
        people.src = peopleImg[1]
        document.body.style.backgroundColor = '#FF9933'
      }
      if (3 <= elapsedTime) {
        document.getElementById('astronaut').style.visibility = 'visible'
        fire.src = fireImg[2]
        people.src = peopleImg[2]
        document.body.style.backgroundColor = '#000033'
      }
      intervalId = setTimeout('picChange()', 1000)
    }

    // setIntervalメソッドの繰り返し処理を解除する関数
    function stopInterval() {
      clearInterval(intervalId)
    }
  </script>
</html>
